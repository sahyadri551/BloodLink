rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // USERS COLLECTION
    match /users/{uid} {
      allow read: if true; // public can view minimal info
      allow create: if request.auth != null; // anyone logged in can register themselves
      allow update, delete: if request.auth.uid == uid // user can modify only their own doc
        || request.auth.token.role == "admin"; // admins can verify hospitals
    }

    // VERIFIED HOSPITALS COLLECTION
    match /verifiedHospitals/{docId} {
      allow read: if true; // public can see verified hospitals
      allow write: if request.auth != null && request.auth.token.role == "admin";
    }

    // BLOOD CAMPS COLLECTION
    match /bloodCamps/{campId} {
      allow read: if true; // public visibility
      allow create: if request.auth != null; // must be logged in (hospital)
      allow update, delete: if request.auth.uid == resource.data.hospitalId
        || request.auth.token.role == "admin";
    }

    // BLOOD REQUESTS COLLECTION
    match /bloodRequests/{reqId} {
      allow read: if true; // public can see active requests
      allow create: if request.auth != null; // only logged in can post
      allow update, delete: if request.auth.uid == resource.data.uid
        || request.auth.token.role == "admin";
    }

    // Default deny all others
    match /{document=**} {
      allow read, write: if false;
    }
  }
}